# 要件定義書: MyTask

## 1. プロジェクト概要

Google Apps Script (GAS) と Google Sheets をバックエンドとして利用する、軽量で直感的な操作が可能なカンバン形式のタスク管理アプリケーション。ユーザーはブラウザ上でタスクのステータス管理、詳細な情報記述、優先度付けを行うことができる。

## 2. ユーザーストーリー (User Story)

### 2.1. タスクの基本操作とステータス管理
- **ユーザーとして**、タスクを「未着手」「実施中」「保留」「完了」の4つのステータスで管理し、現在の進捗を一目で把握したい。
- **ユーザーとして**、カンバンボード上でタスクをドラッグ＆ドロップし、直感的にステータス変更や優先順位（表示順）の入れ替えを行いたい。
- **ユーザーとして**、タスクカード上のチェックアイコンをクリックするだけで、タスクをすばやく「完了」状態に移行（または「実施中」へ差し戻し）したい。

### 2.2. タスクの詳細記述と可視性
- **ユーザーとして**、リッチテキストエディタを用いて、タスク内容に太字、斜体、取り消し線、下線、文字色の装飾を施し、重要な情報を強調したい。
- **ユーザーとして**、タスクカード上には概要（プレビュー）のみを表示し、必要に応じて詳細表示モードに切り替えることで、画面の情報量を最適化したい。
- **ユーザーとして**、タスク期限を設定し、期限切れのタスクは赤字で強調表示されることで、対応漏れを防ぎたい。

### 2.3. タスクの分類と抽出
- **ユーザーとして**、タスクを「グループ」や「優先度（高・中・低）」で分類し、ヘッダーのフィルター機能を用いて特定の条件に合致するタスクのみを抽出表示したい。
- **ユーザーとして**、各ステータスカラムごとにタスクを「表示順」「優先度」「グループ」「期限」のいずれかの基準でソートし、着手すべきタスクを明確にしたい。
- **ユーザーとして**、完了したタスクを非表示に切り替え、現在進行中の作業に集中したい。

### 2.4. 外部連携と付加機能
- **ユーザーとして**、Google Tasks（To-Do リスト）に登録されたタスクを本システムに一括で取り込み、管理を一本化したい。
- **ユーザーとして**、タスク内容にURLが含まれる場合、リンクとして自動認識されるだけでなく、URLの種類（Gmail, Google Drive, Google Calendar, Google Meet等）に応じた専用アイコンが表示されることで、リンク先を直感的に判別したい。
- **ユーザーとして**、各作業環境に合わせてカラムの前後の幅をドラッグで調整（リサイズ）し、快適なレイアウトで利用したい。

## 3. 受け入れ基準 (Acceptance Criteria)

### 3.1. データ同期と完全性
- カンバンボード上でドラッグ＆ドロップによる並び替えやステータス変更を行った際、複数タスクの「ステータス」および「表示順」がGoogle Sheetsへ正確かつ一括で反映されること。
- リッチテキストエディタで適用したスタイル情報（太字、斜体、下線、取り消し線、色指定）が、GASの `RichTextValue` オブジェクトとして欠落なくSheetsに保存され、再読み込み時にWeb画面上で完全に復元表示されること。
- 改行やブラウザ固有のブロック要素（`<div>`, `<br>`, `<p>` 等）が、Sheets上でのプレーンテキストおよびスタイル情報のインデックス位置と正確にマッピングされ、表示崩れが起きないこと。

### 3.2. セキュリティとアクセス権限
- `AccessControl` シートのA列（メールアドレス）に登録されたGoogleアカウントを持つユーザーのみが、Webアプリケーションの初期表示およびデータアクセスを実行できること。未登録ユーザーにはアクセス拒否メッセージが表示されること。

### 3.3. UI/UXの正確な動作
- 「完了の非表示/表示」「詳細の非表示/表示」ボタンのトグル操作により、該当要素のDOMクラスが即座に切り替わり、意図した通りの表示状態となること。
- タスクカードのラベルアイコン（★, ⭐, ⚠️, 💥, 🩷）をクリックすると順番に切り替わり、その状態が即時保存されること。
- タスク完了時（チェックボタン操作時）に、視覚的なフィードバック（フェードアウト/フェードインのアニメーション）を伴ってステータスが移動すること。

## 4. 主要機能 (Key Features)

- **カンバンボードUI**: 「未着手」「実施中」「保留」「完了」の4カラム構成。Sortable.jsによるドラッグ＆ドロップ操作。カラム幅のフレキシブルリサイズ機能。
- **カスタムリッチテキストエディタ**: ブラウザ標準の `contenteditable` を拡張。複数テキストスタイルおよびパレットからの色指定（HEX, RGB等）に対応したHTML⇔RichTextValue双方向変換エンジン (`RichTextLib.js`) を内蔵。
- **タスクフィルタリング＆ソート**: ヘッダー部での「グループ」「優先度」による全体絞り込み機能。各ステータスカラム内での「表示順」「優先度」「グループ」「期限」ごとの動的並び替え機能。
- **動的リンクアイコン自動付与**: 本文やプレビュー内のURL文字列を正規表現で検知し、クリック可能なリンクへ変換。Google関連サービス（Mail, Drive, Calendar, Meet）のドメインを判別してマテリアルアイコンを自動挿入。
- **タスクラベル遷移**: タスクごとに自由なタグ付け用途で使えるローテーション式のラベルアイコン（★, ⭐, ⚠️, 💥, 🩷等）の付加機能。
- **状態の視覚化機能**:
  - 優先度に応じたカード左端のカラーライン表示（高=赤系, 中=黄/金系, 低=緑系）。
  - グループ文字列のハッシュ値から一意な色を自動生成するグループラベルカラー機能。
  - 期限切れタスクの日付テキスト強調（赤字）表示。
- **Google Tasks インポート連携**: ユーザーのGoogleアカウントに紐づくTasks APIをコールし、未完了のタスクリストを重複を排除しつつ本システムへ一括インポートするバックエンド連携機能。

## 5. データ構造 (スプレッドシート)

- **TaskListシート**: 
  - A: ID
  - B: 表示順
  - C: タスクグループ
  - D: タスクタイトル
  - E: タスク内容 (RichText)
  - F: タスク期限
  - G: タスク優先度
  - H: ステータス
  - I: ラベル
- **AccessControlシート**: 
  - A: メールアドレス (アクセス制御用)
